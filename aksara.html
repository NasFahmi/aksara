<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Konverter Latin-Aksara Jawa (Algoritma Lengkap)</title>
    <style>
      /* CSS dipertahankan */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", sans-serif;
      }
      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }
      header {
        background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }
      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }
      .content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        padding: 30px;
      }
      @media (max-width: 768px) {
        .content {
          grid-template-columns: 1fr;
        }
      }
      textarea {
        width: 100%;
        min-height: 200px;
        padding: 20px;
        font-size: 1.1rem;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        resize: vertical;
      }
      .output-area {
        font-family: "Noto Sans JP", sans-serif;
        font-size: 1.8rem;
        background: #f8f9fa;
      }
      .controls {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
      }
      button {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
      }
      .btn-primary {
        background: linear-gradient(135deg, #4a6491 0%, #2c3e50 100%);
        color: white;
      }
      .btn-secondary {
        background: #e9ecef;
        color: #495057;
      }
      .btn-success {
        background: #20c997;
        color: white;
      }
      .examples {
        background: #fff9db;
        padding: 20px;
        margin: 20px 30px;
        border-radius: 10px;
        border-left: 5px solid #f59f00;
      }
      .example-item {
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 5px;
      }
      .correct {
        color: #2b8a3e;
        font-weight: bold;
      }
      .incorrect {
        color: #c92a2a;
        text-decoration: line-through;
      }
      .debug-info {
        background: #e7f5ff;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        font-family: monospace;
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ꦏꦺꦴꦤ꧀ꦮꦼꦂꦱꦶꦭꦠꦶꦤ꧀ꦲꦏ꧀ꦱꦫꦗꦮ</h1>
        <p>Dengan Algoritma Tata Bahasa yang Benar</p>
      </header>

      <div class="content">
        <div>
          <h2>Teks Latin</h2>
          <textarea id="inputText" placeholder="Ketik teks Latin di sini...">
Banyuwangi, Wahyu Hariyanto, Sugeng rawuh</textarea
          >
          <div class="controls">
            <button class="btn-primary" id="convertBtn">Konversi</button>
            <button class="btn-secondary" id="resetBtn">Reset</button>
          </div>
        </div>

        <div>
          <h2>Aksara Jawa</h2>
          <textarea id="outputText" class="output-area" readonly></textarea>
          <div class="controls">
            <button class="btn-success" id="copyBtn">Salin Hasil</button>
          </div>
        </div>
      </div>

      <div class="examples">
        <h3>Contoh Konversi yang Benar:</h3>
        <div class="example-item">
          <span class="incorrect">ꦧꦤ꧀ꦪꦸꦮꦤ꧀ꦒꦶ</span> →
          <span class="correct">ꦧꦚꦸꦮꦔꦶ (Banyuwangi)</span>
        </div>
        <div class="example-item">
          <span class="incorrect">ꦮꦲꦪꦸ</span> →
          <span class="correct">ꦮꦃꦪꦸ (Wahyu)</span>
        </div>
        <div class="example-item">
          <span class="incorrect">ꦲꦫꦶꦪꦤꦠꦵ</span> →
          <span class="correct">ꦲꦫꦶꦪꦤ꧀ꦠꦺꦴ (Hariyanto)</span>
        </div>
        <div class="example-item">
          <span class="incorrect">ꦱꦸꦒꦼꦁꦫꦮꦸꦃ</span> →
          <span class="correct">ꦱꦸꦒꦼꦁꦫꦮꦸꦃ (Sugeng rawuh)</span>
        </div>
      </div>
    </div>

    <script>
      // ======================== ALGORITMA KONVERSI LENGKAP ========================

      //   Aksara Dasar
      const AKSARA = {
        h: "ꦲ",
        n: "ꦤ",
        c: "ꦕ",
        r: "ꦫ",
        k: "ꦏ",
        d: "ꦢ",
        t: "ꦠ",
        s: "ꦱ",
        w: "ꦮ",
        l: "ꦭ",
        p: "ꦥ",
        j: "ꦗ",
        y: "ꦪ",
        m: "ꦩ",
        g: "ꦒ",
        b: "ꦧ",
        ng: "ꦔ",
        ny: "ꦚ",
        th: "ꦛ",
        dh: "ꦝ",
      };

      // Pasangan
      const PASANGAN = {
        h: "꧀ꦲ",
        n: "꧀ꦤ",
        c: "꧀ꦕ",
        r: "꧀ꦫ",
        k: "꧀ꦏ",
        d: "꧀ꦢ",
        t: "꧀ꦠ",
        s: "꧀ꦱ",
        w: "꧀ꦮ",
        l: "꧀ꦭ",
        p: "꧀ꦥ",
        j: "꧀ꦗ",
        y: "꧀ꦪ",
        m: "꧀ꦩ",
        g: "꧀ꦒ",
        b: "꧀ꦧ",
        ng: "꧀ꦔ",
        ny: "꧀ꦚ",
        th: "꧀ꦛ",
        dh: "꧀ꦝ",
      };

      //Sandhangan Vokal
      const VOKAL = {
        a: "",
        i: "ꦶ",
        u: "ꦸ",
        e: "ꦼ",
        é: "ꦺ",
        o: "ꦺꦴ",
      };

      // Vokal Mandiri
      const VOKAL_MANDIRI = {
        a: "ꦄ",
        i: "ꦆ",
        u: "ꦈ",
        e: "ꦌ",
        o: "ꦎ",
      };

      const AKHIRAN = {
        ng: "ꦁ",
        r: "ꦂ",
        h: "ꦃ",
      };

      const CLUSTER = {
        r: "ꦿ",
        y: "ꦾ",
        l: "ꦭꦾ",
        w: "ꦮ",
      };

      const MURDA = {
        n: "ꦟ",
        k: "ꦑ",
        t: "ꦡ",
        s: "ꦯ",
        p: "ꦦ",
        b: "ꦨ",
        g: "ꦓ",
        j: "ꦙ",
      };

      const AKSARA_LATIN = Object.fromEntries(
        Object.entries(AKSARA).map(([k, v]) => [v, k])
      );

      const MURDA_LATIN = Object.fromEntries(
        Object.entries(MURDA).map(([k, v]) => [v, k])
      );

      const VOKAL_LATIN = {
        "ꦶ": "i",
        "ꦸ": "u",
        "ꦼ": "e",
        "ꦺꦴ": "o",
        "ꦺ": "é",
        "": "a",
      };

      const VOKAL_MANDIRI_LATIN = {
        "ꦄ": "a",
        "ꦆ": "i",
        "ꦈ": "u",
        "ꦌ": "e",
        "ꦎ": "o",
      };

      const AKHIRAN_LATIN = {
        "ꦁ": "ng",
        "ꦂ": "r",
        "ꦃ": "h",
      };

      const CLUSTER_LATIN = {
        "ꦿ": "r",
        "ꦾ": "y",
      };

      const PANGKON = "꧀";

      function tokenize(text) {
        const raw = text.match(/ng|ny|dh|th|[A-Za-z]|[^\w\s]+|\s+/g) || [];

        return raw.map((t) => ({
          raw: t,
          lower: t.toLowerCase(),
        }));
      }

      function isVowel(t) {
        return t && VOKAL.hasOwnProperty(t.lower);
      }

      function isConsonant(t) {
        return t && AKSARA.hasOwnProperty(t.lower);
      }

      function applyPangkon(syllables) {
        for (let i = 0; i < syllables.length - 1; i++) {
          const curr = syllables[i];
          const next = syllables[i + 1];

          // skip simbol & vokal mandiri
          if (!curr.onset || !next.onset) continue;

          // JANGAN pangkon jika:
          // 1. suku kata sekarang punya vokal (CV)
          // 2. suku kata berikutnya juga CV
          if (curr.vowel && next.vowel) continue;

          // JANGAN pangkon jika next punya cluster
          if (next.cluster) continue;

          // JANGAN pangkon jika curr punya coda eksplisit (ng, r, h)
          if (curr.coda) continue;

          // BARU boleh pangkon:
          // curr adalah konsonan mati + next konsonan
          curr.dead = true;
        }
      }

      function parseSyllables(tokens) {
        const result = [];
        let i = 0;

        while (i < tokens.length) {
          const t = tokens[i].lower;
          const raw = tokens[i].raw;

          // spasi / simbol
          if (!/[a-z]/.test(t)) {
            result.push({ type: "symbol", value: t });
            i++;
            continue;
          }

          // VOKAL MANDIRI
          if (isVowel(t)) {
            result.push({ onset: null, vowel: t, coda: null });
            i++;
            continue;
          }

          // KONSONAN (termasuk ng, ny, dh, th)
          if (isConsonant(tokens[i])) {
            let onset = tokens[i].lower;
            let isCapital = tokens[i].raw !== tokens[i].raw.toLowerCase();
            let vowel = "a";
            let coda = null;
            let cluster = null;

            if (["r", "y", "l", "w"].includes(tokens[i + 1]?.lower)) {
              cluster = tokens[i + 1].lower;
              i++;
            }

            if (isVowel(tokens[i + 1])) {
              vowel = tokens[i + 1].lower;
              i++;
            }

            if (AKHIRAN[tokens[i + 1]?.lower]) {
              coda = tokens[i + 1].lower;
              i++;
            }

            result.push({
              onset,
              vowel,
              coda,
              cluster,
              dead: false,
              isCapital, // <--- INI KUNCINYA
            });

            i++;
            continue;
          }

          // fallback aman
          i++;
        }

        return result;
      }

      function render(syllables) {
        let out = "";

        syllables.forEach((s, idx) => {
          if (s.type === "symbol") {
            out += s.value;
            return;
          }

          // vokal mandiri
          if (!s.onset) {
            out += VOKAL_MANDIRI[s.vowel];
            return;
          }

          // aksara utama
          if (s.isCapital && MURDA[s.onset]) {
            out += MURDA[s.onset];
          } else {
            out += AKSARA[s.onset];
          }

          // cluster
          if (s.cluster) {
            out += CLUSTER[s.cluster];
          }

          // sandhangan
          out += VOKAL[s.vowel] || "";

          // akhiran
          if (s.coda) {
            out += AKHIRAN[s.coda] || PASANGAN[s.coda];
          }
          // setelah sandhangan vokal
          if (s.dead && !s.coda) {
            out += "꧀"; // pangkon
          }
        });

        return out;
      }

      function latinToJawa(text) {
        const tokens = tokenize(text);
        const syllables = parseSyllables(tokens);
        applyPangkon(syllables);
        return render(syllables);
      }

      function jawaToLatin(text) {
        let result = "";
        let i = 0;

        while (i < text.length) {
          const ch = text[i];

          // Handle vowel mandiri (standalone vowels)
          if (VOKAL_MANDIRI_LATIN[ch]) {
            result += VOKAL_MANDIRI_LATIN[ch];
            i++;
            continue;
          }

          // Handle spaces and symbols
          if (!AKSARA_LATIN[ch] && !MURDA_LATIN[ch] && !AKHIRAN_LATIN[ch]) {
            result += ch;
            i++;
            continue;
          }

          // Process consonant + possible modifiers as a single unit
          let base = AKSARA_LATIN[ch] || MURDA_LATIN[ch];
          if (base) {
            i++; // consume the consonant

            // Check for clusters that follow this consonant
            if (i < text.length && CLUSTER_LATIN[text[i]]) {
              base += CLUSTER_LATIN[text[i]];
              i++;
            }

            // Check what comes after the base consonant
            let vowel = 'a'; // default vowel
            let coda = ''; // ending consonant

            // Check for pangkon (indicates no vowel)
            if (i < text.length && text[i] === PANGKON) {
              vowel = ''; // no vowel for this base
              i++; // consume pangkon

              // After pangkon, check for ending consonant
              if (i < text.length && AKHIRAN_LATIN[text[i]]) {
                coda = AKHIRAN_LATIN[text[i]];
                i++;
              }

              // Add to result immediately since vowel is suppressed
              result += base + coda;
              continue;
            }

            // No pangkon, so process vowels and ending consonants
            // First, carefully check for 2-character vowel markers (like "ꦺꦴ" for "o")
            if (i < text.length) {
              if (i + 1 < text.length && VOKAL_LATIN[text.slice(i, i + 2)]) {
                vowel = VOKAL_LATIN[text.slice(i, i + 2)]; // This gets "o" from "ꦺꦴ"
                i += 2; // consume both characters
              }
              // Then check for 1-character vowel markers
              else if (VOKAL_LATIN[text[i]]) {
                vowel = VOKAL_LATIN[text[i]];
                i++; // consume one character
              }
              // If no vowel marker but there's an ending consonant, apply it without vowel
              else if (AKHIRAN_LATIN[text[i]]) {
                coda = AKHIRAN_LATIN[text[i]];
                vowel = ''; // no vowel when only coda
                i++; // consume the ending consonant
              }
            }

            // After handling vowels, check again for ending consonants if we had a vowel
            if (vowel && i < text.length && AKHIRAN_LATIN[text[i]]) {
              coda = AKHIRAN_LATIN[text[i]];
              i++; // consume the ending consonant
            }

            result += base + vowel + coda;
          } else if (AKHIRAN_LATIN[ch]) {
            // Handle standalone ending consonants
            result += AKHIRAN_LATIN[ch] + 'a';
            i++;
          }
        }

        return result;
      }

      console.log("test aksara");

      console.log(latinToJawa("banyuwangi"));
      // ꦧꦚꦸꦮꦔꦶ

      console.log(latinToJawa("wahyu"));
      // ꦮꦃꦪꦸ

      console.log(latinToJawa("hariyanto"));
      // ꦲꦫꦶꦪꦤ꧀ꦠꦺꦴ

      console.log(latinToJawa("sugeng rawuh"));
      // ꦱꦸꦒꦼꦁ ꦫꦮꦸꦃ

      //test pangkon

      console.log("test pangkon");
      console.log(latinToJawa("bant")); // ꦧꦤ꧀ꦠ
      console.log(latinToJawa("kartu")); // ꦏꦂꦠꦸ
      console.log(latinToJawa("bangsa")); // ꦧꦁꦱ

      //test cluster

      console.log("test cluster");
      console.log(latinToJawa("kra")); // ꦏꦿ
      console.log(latinToJawa("kri")); // ꦏꦿꦶ
      console.log(latinToJawa("kya")); // ꦏꦾ
      console.log(latinToJawa("gla")); // ꦒꦭꦾ
      console.log(latinToJawa("dwa")); // ꦢꦿꦮ
      console.log(latinToJawa("sugeng rawuh"));

      console.log("test murda");
      console.log(latinToJawa("Banyuwangi"));
      // ꦨꦚꦸꦮꦔꦶ

      console.log(latinToJawa("Surakarta"));
      // ꦯꦸꦫꦏꦂꦠ

      console.log(latinToJawa("Negara"));
      // ꦟꦼꦒꦫ

      console.log(latinToJawa("sugeng Rawuh"));

      console.log("test jawa → latin");

      console.log(jawaToLatin("ꦧꦚꦸꦮꦔꦶ")); // banyuwangi
      console.log(jawaToLatin("ꦮꦃꦪꦸ")); // wahyu
      console.log(jawaToLatin("ꦲꦫꦶꦪꦤ꧀ꦠꦺꦴ")); // hariyanto
      console.log(jawaToLatin("ꦱꦸꦒꦼꦁ ꦫꦮꦸꦃ")); // sugeng rawuh
      console.log(jawaToLatin("ꦏꦿꦶ")); // kri
      console.log(jawaToLatin("ꦧꦤ꧀ꦠ")); // bant
    </script>
  </body>
</html>
